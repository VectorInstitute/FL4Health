<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark">
    <meta name="google-site-verification" content="i0qQRaR9OA3tSz_9tDocdcXGY27Ox_cy4FrvTHD2C_0" />
    
      <meta name="description" content="aieng-template Python API documentation">
    <link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <meta name="generator" content="sphinx-8.1.3, furo 2024.08.06"/>

    
    <meta name="msvalidate.01" content="8D2A5032F006424CAF54C0DDCD16F666" />
      
        <title>fl4health.metrics.efficient_metrics_base - FL4Health</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #faad1a;
  --color-brand-content: #eb088a;
  --color-foreground-secondary: #52c7de;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #faad1a;
  --color-brand-content: #eb088a;
  --color-foreground-secondary: #52c7de;
  
      }
    }
  }
</style><script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=ccdb6887"></script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../_static/require.min.js?v=53367eec"></script>
    <script src="../../../_static/custom.js?v=c3ea0f6c"></script>
    
    <script src="https://kit.fontawesome.com/2c1f516901.js" crossorigin="anonymous"></script>

  </head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">FL4Health</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">FL4Health</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../module_guides/index.html">Module Guides</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Module Guides</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../module_guides/checkpointing/index.html">Checkpointing</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../examples/index.html">Examples</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Examples</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/basic/index.html">Basic Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../api.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../reference/api/fl4health.html">fl4health package</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of fl4health package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.checkpointing.html">fl4health.checkpointing package</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of fl4health.checkpointing package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.checkpointing.checkpointer.html">fl4health.checkpointing.checkpointer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.checkpointing.client_module.html">fl4health.checkpointing.client_module module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.checkpointing.opacus_checkpointer.html">fl4health.checkpointing.opacus_checkpointer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.checkpointing.server_module.html">fl4health.checkpointing.server_module module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.client_managers.html">fl4health.client_managers package</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of fl4health.client_managers package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.client_managers.base_sampling_manager.html">fl4health.client_managers.base_sampling_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.client_managers.fixed_sampling_client_manager.html">fl4health.client_managers.fixed_sampling_client_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.client_managers.fixed_without_replacement_manager.html">fl4health.client_managers.fixed_without_replacement_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.client_managers.poisson_sampling_manager.html">fl4health.client_managers.poisson_sampling_manager module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.clients.html">fl4health.clients package</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of fl4health.clients package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.clients.deep_mmd_clients.html">fl4health.clients.deep_mmd_clients package</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of fl4health.clients.deep_mmd_clients package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.clients.deep_mmd_clients.ditto_deep_mmd_client.html">fl4health.clients.deep_mmd_clients.ditto_deep_mmd_client module</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.clients.mkmmd_clients.html">fl4health.clients.mkmmd_clients package</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of fl4health.clients.mkmmd_clients package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.clients.mkmmd_clients.ditto_mkmmd_client.html">fl4health.clients.mkmmd_clients.ditto_mkmmd_client module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.clients.mkmmd_clients.mr_mtl_mkmmd_client.html">fl4health.clients.mkmmd_clients.mr_mtl_mkmmd_client module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.adaptive_drift_constraint_client.html">fl4health.clients.adaptive_drift_constraint_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.apfl_client.html">fl4health.clients.apfl_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.basic_client.html">fl4health.clients.basic_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.clipping_client.html">fl4health.clients.clipping_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.constrained_fenda_client.html">fl4health.clients.constrained_fenda_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.ditto_client.html">fl4health.clients.ditto_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.ensemble_client.html">fl4health.clients.ensemble_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.evaluate_client.html">fl4health.clients.evaluate_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fed_pca_client.html">fl4health.clients.fed_pca_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fed_prox_client.html">fl4health.clients.fed_prox_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fedbn_client.html">fl4health.clients.fedbn_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fedper_client.html">fl4health.clients.fedper_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fedpm_client.html">fl4health.clients.fedpm_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fedrep_client.html">fl4health.clients.fedrep_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fenda_client.html">fl4health.clients.fenda_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.fenda_ditto_client.html">fl4health.clients.fenda_ditto_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.flash_client.html">fl4health.clients.flash_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.instance_level_dp_client.html">fl4health.clients.instance_level_dp_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.model_merge_client.html">fl4health.clients.model_merge_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.moon_client.html">fl4health.clients.moon_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.mr_mtl_client.html">fl4health.clients.mr_mtl_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.nnunet_client.html">fl4health.clients.nnunet_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.partial_weight_exchange_client.html">fl4health.clients.partial_weight_exchange_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.perfcl_client.html">fl4health.clients.perfcl_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.scaffold_client.html">fl4health.clients.scaffold_client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.clients.tabular_data_client.html">fl4health.clients.tabular_data_client module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.datasets.html">fl4health.datasets package</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of fl4health.datasets package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.datasets.rxrx1.html">fl4health.datasets.rxrx1 package</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of fl4health.datasets.rxrx1 package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.datasets.rxrx1.load_data.html">fl4health.datasets.rxrx1.load_data module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.datasets.rxrx1.preprocess.html">fl4health.datasets.rxrx1.preprocess module</a></li>
</ul>
</li>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.datasets.skin_cancer.html">fl4health.datasets.skin_cancer package</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of fl4health.datasets.skin_cancer package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.datasets.skin_cancer.load_data.html">fl4health.datasets.skin_cancer.load_data module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.datasets.skin_cancer.preprocess_skin.html">fl4health.datasets.skin_cancer.preprocess_skin module</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.feature_alignment.html">fl4health.feature_alignment package</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of fl4health.feature_alignment package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.feature_alignment.constants.html">fl4health.feature_alignment.constants module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.feature_alignment.string_columns_transformer.html">fl4health.feature_alignment.string_columns_transformer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.feature_alignment.tab_features_info_encoder.html">fl4health.feature_alignment.tab_features_info_encoder module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.feature_alignment.tab_features_preprocessor.html">fl4health.feature_alignment.tab_features_preprocessor module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.feature_alignment.tabular_feature.html">fl4health.feature_alignment.tabular_feature module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.feature_alignment.tabular_type.html">fl4health.feature_alignment.tabular_type module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.losses.html">fl4health.losses package</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of fl4health.losses package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.losses.contrastive_loss.html">fl4health.losses.contrastive_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.losses.cosine_similarity_loss.html">fl4health.losses.cosine_similarity_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.losses.deep_mmd_loss.html">fl4health.losses.deep_mmd_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.losses.fenda_loss_config.html">fl4health.losses.fenda_loss_config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.losses.mkmmd_loss.html">fl4health.losses.mkmmd_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.losses.perfcl_loss.html">fl4health.losses.perfcl_loss module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.losses.weight_drift_loss.html">fl4health.losses.weight_drift_loss module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.metrics.html">fl4health.metrics package</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of fl4health.metrics package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.base_metrics.html">fl4health.metrics.base_metrics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.compound_metrics.html">fl4health.metrics.compound_metrics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.efficient_metrics.html">fl4health.metrics.efficient_metrics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html">fl4health.metrics.efficient_metrics_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.metric_aggregation.html">fl4health.metrics.metric_aggregation module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.metric_managers.html">fl4health.metrics.metric_managers module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.metrics.html">fl4health.metrics.metrics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.metrics_utils.html">fl4health.metrics.metrics_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.metrics.utils.html">fl4health.metrics.utils module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.mixins.html">fl4health.mixins package</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of fl4health.mixins package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.mixins.personalized.html">fl4health.mixins.personalized package</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of fl4health.mixins.personalized package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.mixins.personalized.ditto.html">fl4health.mixins.personalized.ditto module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.mixins.personalized.utils.html">fl4health.mixins.personalized.utils module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.mixins.adaptive_drift_constrained.html">fl4health.mixins.adaptive_drift_constrained module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.mixins.core_protocols.html">fl4health.mixins.core_protocols module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.html">fl4health.model_bases package</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of fl4health.model_bases package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.masked_layers.html">fl4health.model_bases.masked_layers package</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of fl4health.model_bases.masked_layers package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.masked_layers.masked_conv.html">fl4health.model_bases.masked_layers.masked_conv module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.masked_layers.masked_layers_utils.html">fl4health.model_bases.masked_layers.masked_layers_utils module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.masked_layers.masked_linear.html">fl4health.model_bases.masked_layers.masked_linear module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.masked_layers.masked_normalization_layers.html">fl4health.model_bases.masked_layers.masked_normalization_layers module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.apfl_base.html">fl4health.model_bases.apfl_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.autoencoders_base.html">fl4health.model_bases.autoencoders_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.ensemble_base.html">fl4health.model_bases.ensemble_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.feature_extractor_buffer.html">fl4health.model_bases.feature_extractor_buffer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.fedrep_base.html">fl4health.model_bases.fedrep_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.fedsimclr_base.html">fl4health.model_bases.fedsimclr_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.fenda_base.html">fl4health.model_bases.fenda_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.moon_base.html">fl4health.model_bases.moon_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.parallel_split_models.html">fl4health.model_bases.parallel_split_models module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.partial_layer_exchange_model.html">fl4health.model_bases.partial_layer_exchange_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.pca.html">fl4health.model_bases.pca module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.perfcl_base.html">fl4health.model_bases.perfcl_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.model_bases.sequential_split_models.html">fl4health.model_bases.sequential_split_models module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.html">fl4health.parameter_exchange package</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of fl4health.parameter_exchange package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.fedpm_exchanger.html">fl4health.parameter_exchange.fedpm_exchanger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.full_exchanger.html">fl4health.parameter_exchange.full_exchanger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.layer_exchanger.html">fl4health.parameter_exchange.layer_exchanger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.packing_exchanger.html">fl4health.parameter_exchange.packing_exchanger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.parameter_exchanger_base.html">fl4health.parameter_exchange.parameter_exchanger_base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.parameter_packer.html">fl4health.parameter_exchange.parameter_packer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.parameter_selection_criteria.html">fl4health.parameter_exchange.parameter_selection_criteria module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.partial_parameter_exchanger.html">fl4health.parameter_exchange.partial_parameter_exchanger module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.parameter_exchange.sparse_coo_parameter_exchanger.html">fl4health.parameter_exchange.sparse_coo_parameter_exchanger module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.preprocessing.html">fl4health.preprocessing package</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of fl4health.preprocessing package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.preprocessing.autoencoders.html">fl4health.preprocessing.autoencoders package</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of fl4health.preprocessing.autoencoders package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.preprocessing.autoencoders.dim_reduction.html">fl4health.preprocessing.autoencoders.dim_reduction module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.preprocessing.autoencoders.loss.html">fl4health.preprocessing.autoencoders.loss module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.preprocessing.pca_preprocessor.html">fl4health.preprocessing.pca_preprocessor module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.preprocessing.warmed_up_module.html">fl4health.preprocessing.warmed_up_module module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.privacy.html">fl4health.privacy package</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of fl4health.privacy package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.privacy.fl_accountants.html">fl4health.privacy.fl_accountants module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.privacy.moments_accountant.html">fl4health.privacy.moments_accountant module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.reporting.html">fl4health.reporting package</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of fl4health.reporting package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.reporting.base_reporter.html">fl4health.reporting.base_reporter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.reporting.json_reporter.html">fl4health.reporting.json_reporter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.reporting.reports_manager.html">fl4health.reporting.reports_manager module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.reporting.wandb_reporter.html">fl4health.reporting.wandb_reporter module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.servers.html">fl4health.servers package</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of fl4health.servers package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4 has-children"><a class="reference internal" href="../../../reference/api/fl4health.servers.adaptive_constraint_servers.html">fl4health.servers.adaptive_constraint_servers package</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of fl4health.servers.adaptive_constraint_servers package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.servers.adaptive_constraint_servers.ditto_server.html">fl4health.servers.adaptive_constraint_servers.ditto_server module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.servers.adaptive_constraint_servers.fedprox_server.html">fl4health.servers.adaptive_constraint_servers.fedprox_server module</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../../reference/api/fl4health.servers.adaptive_constraint_servers.mrmtl_server.html">fl4health.servers.adaptive_constraint_servers.mrmtl_server module</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.base_server.html">fl4health.servers.base_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.client_level_dp_fed_avg_server.html">fl4health.servers.client_level_dp_fed_avg_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.evaluate_server.html">fl4health.servers.evaluate_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.fedpm_server.html">fl4health.servers.fedpm_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.instance_level_dp_server.html">fl4health.servers.instance_level_dp_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.model_merge_server.html">fl4health.servers.model_merge_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.nnunet_server.html">fl4health.servers.nnunet_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.polling.html">fl4health.servers.polling module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.scaffold_server.html">fl4health.servers.scaffold_server module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.servers.tabular_feature_alignment_server.html">fl4health.servers.tabular_feature_alignment_server module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.strategies.html">fl4health.strategies package</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of fl4health.strategies package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.aggregate_utils.html">fl4health.strategies.aggregate_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.basic_fedavg.html">fl4health.strategies.basic_fedavg module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.client_dp_fedavgm.html">fl4health.strategies.client_dp_fedavgm module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.fedavg_dynamic_layer.html">fl4health.strategies.fedavg_dynamic_layer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.fedavg_sparse_coo_tensor.html">fl4health.strategies.fedavg_sparse_coo_tensor module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.fedavg_with_adaptive_constraint.html">fl4health.strategies.fedavg_with_adaptive_constraint module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.feddg_ga.html">fl4health.strategies.feddg_ga module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.feddg_ga_with_adaptive_constraint.html">fl4health.strategies.feddg_ga_with_adaptive_constraint module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.fedpca.html">fl4health.strategies.fedpca module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.fedpm.html">fl4health.strategies.fedpm module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.flash.html">fl4health.strategies.flash module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.model_merge_strategy.html">fl4health.strategies.model_merge_strategy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.noisy_aggregate.html">fl4health.strategies.noisy_aggregate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.scaffold.html">fl4health.strategies.scaffold module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.strategies.strategy_with_poll.html">fl4health.strategies.strategy_with_poll module</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../../reference/api/fl4health.utils.html">fl4health.utils package</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle navigation of fl4health.utils package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.client.html">fl4health.utils.client module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.config.html">fl4health.utils.config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.data_generation.html">fl4health.utils.data_generation module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.dataset.html">fl4health.utils.dataset module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.dataset_converter.html">fl4health.utils.dataset_converter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.early_stopper.html">fl4health.utils.early_stopper module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.functions.html">fl4health.utils.functions module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.load_data.html">fl4health.utils.load_data module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.logging.html">fl4health.utils.logging module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.losses.html">fl4health.utils.losses module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.metrics.html">fl4health.utils.metrics module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.msd_dataset_sources.html">fl4health.utils.msd_dataset_sources module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.nnunet_utils.html">fl4health.utils.nnunet_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.parameter_extraction.html">fl4health.utils.parameter_extraction module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.partitioners.html">fl4health.utils.partitioners module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.peft_parameter_extraction.html">fl4health.utils.peft_parameter_extraction module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.privacy_utilities.html">fl4health.utils.privacy_utilities module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.random.html">fl4health.utils.random module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.sampler.html">fl4health.utils.sampler module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.snapshotter.html">fl4health.utils.snapshotter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../reference/api/fl4health.utils.typing.html">fl4health.utils.typing module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for fl4health.metrics.efficient_metrics_base</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">INFO</span><span class="p">,</span> <span class="n">WARNING</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flwr.common.logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flwr.common.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Metrics</span><span class="p">,</span> <span class="n">Scalar</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">fl4health.metrics.base_metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">Metric</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fl4health.metrics.metrics_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">threshold_tensor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fl4health.metrics.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">align_pred_and_target_shapes</span>


<div class="viewcode-block" id="MetricOutcome">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.MetricOutcome">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MetricOutcome</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">TRUE_POSITIVE</span> <span class="o">=</span> <span class="s2">&quot;true_positive&quot;</span>
    <span class="n">FALSE_POSITIVE</span> <span class="o">=</span> <span class="s2">&quot;false_positive&quot;</span>
    <span class="n">TRUE_NEGATIVE</span> <span class="o">=</span> <span class="s2">&quot;true_negative&quot;</span>
    <span class="n">FALSE_NEGATIVE</span> <span class="o">=</span> <span class="s2">&quot;false_negative&quot;</span></div>



<div class="viewcode-block" id="ClassificationMetric">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.ClassificationMetric">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ClassificationMetric</span><span class="p">(</span><span class="n">Metric</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<div class="viewcode-block" id="ClassificationMetric.__init__">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.ClassificationMetric.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">label_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">batch_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">discard</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">MetricOutcome</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A Base class for efficiently computing classification metrics that can be calculated using the true positives</span>
<span class="sd">        (tp), false positive (fp), false negative (fn) and true negative (tn) counts.</span>

<span class="sd">        How these values are counted is left to the inheriting class along with how they are composed together for the</span>
<span class="sd">        final metric score. There are two classes inheriting from this class to form the basis of efficient</span>
<span class="sd">        classification metrics: BinaryClassificationMetric and MultiClassificationMetric. These handle implementation</span>
<span class="sd">        of the ``count_tp_fp_tn_fn`` method.</span>

<span class="sd">        On each update, the true_positives, false_positives, false_negatives and true_negatives counts for the</span>
<span class="sd">        provided predictions and targets are accumulated into ``self.true_positives``, ``self.false_positives``,</span>
<span class="sd">        ``self.false_negatives`` and ``self.true_negatives``, respectively. This reduces the memory footprint</span>
<span class="sd">        required to compute metrics across rounds. The user needs to define the ``compute_from_counts`` method which</span>
<span class="sd">        returns a dictionary of Scalar metrics given the ``true_positives``, ``false_positives``, ``false_negatives``,</span>
<span class="sd">        and  ``true_negatives`` counts. The accumulated counts are reset by the ``clear`` method. If your subclass</span>
<span class="sd">        returns multiple metrics you may need to also override the ``__call__`` method.</span>

<span class="sd">        If the predictions provided are continuous in value, then the associated counts will also be continuous</span>
<span class="sd">        (&quot;soft&quot;). For example, with a target of 1, a prediction of 0.8 contributes 0.8 to the true_positives count and</span>
<span class="sd">        0.2 to the false_negatives.</span>

<span class="sd">        NOTE: Preds and targets are expected to have elements in the interval [0, 1] or to be thresholded, using</span>
<span class="sd">        the argument of this class to be as such.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the metric.</span>
<span class="sd">            label_dim (int | None, optional): Specifies which dimension in the provided tensors corresponds to the</span>
<span class="sd">                label dimension.</span>
<span class="sd">            batch_dim (int | None, optional): If None, then counts are aggregated across the batch dimension. If</span>
<span class="sd">                specified, counts will be computed along the dimension specified. That is, counts are maintained for</span>
<span class="sd">                each training sample INDIVIDUALLY.</span>

<span class="sd">                NOTE: The resulting counts will always be presented batch dimension first, then label dimension,</span>
<span class="sd">                regardless of input shape.</span>
<span class="sd">            dtype (torch.dtype): The dtype to store the counts as. If preds or targets can be continuous, specify a</span>
<span class="sd">                float type. Otherwise specify an integer type to prevent overflow.</span>
<span class="sd">            threshold (float | int | None, optional): A float for thresholding values or an integer specifying the</span>
<span class="sd">                index of the label dimension. If a float is given, predictions below the threshold are mapped</span>
<span class="sd">                to 0 and above are mapped to 1. If an integer is given, predictions are binarized based on the class</span>
<span class="sd">                with the highest prediction where the specified axis is assumed to contain a prediction for each class</span>
<span class="sd">                (where its index along that dimension is the class label). Setting to None leaves preds unchanged.</span>
<span class="sd">            discard (set[MetricOutcome] | None, optional): One or several of MetricOutcome values. Specified outcome</span>
<span class="sd">                counts will not be accumulated. Their associated attribute will remain as an empty pytorch tensor.</span>
<span class="sd">                Useful for reducing the memory footprint of metrics that do not use all of the counts in their</span>
<span class="sd">                computation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="o">=</span> <span class="n">label_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="o">=</span> <span class="n">batch_dim</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span>
                    <span class="n">WARNING</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Specified threshold dimension: </span><span class="si">{</span><span class="n">threshold</span><span class="si">}</span><span class="s2"> is not the same as the label_dim: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label_dim</span><span class="si">}</span><span class="s2">. This is atypical and may produce undesired behavior&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The label and batch dimensions must differ but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Parse discard argument</span>
        <span class="n">discard</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="n">discard</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">discard</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">discard_tp</span> <span class="o">=</span> <span class="n">MetricOutcome</span><span class="o">.</span><span class="n">TRUE_POSITIVE</span> <span class="ow">in</span> <span class="n">discard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discard_fp</span> <span class="o">=</span> <span class="n">MetricOutcome</span><span class="o">.</span><span class="n">FALSE_POSITIVE</span> <span class="ow">in</span> <span class="n">discard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discard_fn</span> <span class="o">=</span> <span class="n">MetricOutcome</span><span class="o">.</span><span class="n">FALSE_NEGATIVE</span> <span class="ow">in</span> <span class="n">discard</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discard_tn</span> <span class="o">=</span> <span class="n">MetricOutcome</span><span class="o">.</span><span class="n">TRUE_NEGATIVE</span> <span class="ow">in</span> <span class="n">discard</span>

        <span class="c1"># Create intermediate tensors. Will be initialized with tensors of correct shape on first update.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_negatives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">true_negatives</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([]),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([]),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([]),</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([]),</span>
        <span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_transform_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the predictions and targets this function performs two possible transformations. The first is to map</span>
<span class="sd">        boolean tensors to integers for computation. The second is to potentially threshold the predictions if</span>
<span class="sd">        self.threshold is not None</span>

<span class="sd">        NOTE: This is a common implementation meant to be called (or overridden) by inheriting classes.</span>

<span class="sd">        Args:</span>
<span class="sd">            preds (torch.Tensor): Predictions tensor</span>
<span class="sd">            targets (torch.Tensor): Targets tensor</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[torch.Tensor, torch.Tensor]: Potentially transformed predictions and targets tensors, in that order</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># On the off chance were given booleans convert them to integers</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">preds</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">if</span> <span class="n">preds</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span> <span class="k">else</span> <span class="n">preds</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">if</span> <span class="n">targets</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">torch</span><span class="o">.</span><span class="n">bool</span> <span class="k">else</span> <span class="n">targets</span>

        <span class="c1"># Maybe threshold predictions into &#39;hard&#39; predictions.</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">preds</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">threshold_tensor</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_assert_correct_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensures that the prediction and target tensors are within the expected ranges for computation.</span>

<span class="sd">        NOTE: This is a common implementation meant to be called (or overridden) by inheriting classes.</span>

<span class="sd">        Args:</span>
<span class="sd">            preds (torch.Tensor): Predictions tensor</span>
<span class="sd">            targets (torch.Tensor): Targets tensor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Expected preds to be in range [0, 1].&quot;</span>
        <span class="k">assert</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Expected targets to be in range [0, 1].&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_counts_from_preds_and_targets</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute counts. If were ignoring a count, set it as an empty tensor to avoid downstream errors.</span>

<span class="sd">        NOTE: preds and targets are assumed to be in range [0, 1]. Otherwise the computations below may produce</span>
<span class="sd">        unexpected results.</span>

<span class="sd">        Args:</span>
<span class="sd">            preds (torch.Tensor): Predictions tensor</span>
<span class="sd">            targets (torch.Tensor): Targets tensor</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]: True positive, false positive,</span>
<span class="sd">                true negative, and false negative indications for each of the predictions in the provided tensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">true_positives</span> <span class="o">=</span> <span class="p">(</span><span class="n">preds</span> <span class="o">*</span> <span class="n">targets</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_tp</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="n">false_positives</span> <span class="o">=</span> <span class="p">(</span><span class="n">preds</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">targets</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_fp</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="n">false_negatives</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">preds</span><span class="p">)</span> <span class="o">*</span> <span class="n">targets</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_fn</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="n">true_negatives</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">preds</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">targets</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_tn</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="k">return</span> <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_sum_along_axes_or_discard</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sum_axes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
        <span class="n">true_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">true_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provided a set of axes over which to reduce by summation. These sums are applied to each of the</span>
<span class="sd">        provided tensors.</span>

<span class="sd">        Args:</span>
<span class="sd">            sum_axes (tuple[int, ...]): The dimension or dimensions to reduce. If empty, all dimensions are reduced.</span>
<span class="sd">            true_positives (torch.Tensor): Tensor with entry of 1 indicating a true positive for a pred/target pair</span>
<span class="sd">            false_positives (torch.Tensor): Tensor with entry of 1 indicating a false positive for a pred/target pair</span>
<span class="sd">            true_negatives (torch.Tensor): Tensor with entry of 1 indicating a true negative for a pred/target pair</span>
<span class="sd">            false_negatives (torch.Tensor): Tensor with entry of 1 indicating a false negative for a pred/target pair</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]: Tensors reduced over the specified axes</span>
<span class="sd">                in the order ``true_positives``, ``false_positives``, ``true_negatives``, ``false_negatives``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">true_positives</span> <span class="o">=</span> <span class="n">true_positives</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sum_axes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_tp</span> <span class="k">else</span> <span class="n">true_positives</span>
        <span class="n">false_positives</span> <span class="o">=</span> <span class="n">false_positives</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sum_axes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_fp</span> <span class="k">else</span> <span class="n">false_positives</span>
        <span class="n">false_negatives</span> <span class="o">=</span> <span class="n">false_negatives</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sum_axes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_fn</span> <span class="k">else</span> <span class="n">false_negatives</span>
        <span class="n">true_negatives</span> <span class="o">=</span> <span class="n">true_negatives</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sum_axes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">discard_tn</span> <span class="k">else</span> <span class="n">true_negatives</span>
        <span class="k">return</span> <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span>

<div class="viewcode-block" id="ClassificationMetric.update">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.ClassificationMetric.update">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the existing self.true_positive, self.false_positive, self.false_negative and self.true_negative</span>
<span class="sd">        counts with new counts computed from preds and targets.</span>

<span class="sd">        NOTE: In the implementation, this function implicitly assumes that the child classes inheriting from this</span>
<span class="sd">        class have implemented `count_tp_fp_tn_fn` such that, if `self.batch_dim` is not None, the counts are returned</span>
<span class="sd">        with shapes such that the batch dimension comes FIRST for the counts.</span>

<span class="sd">        Args:</span>
<span class="sd">            preds (torch.Tensor): Predictions tensor</span>
<span class="sd">            targets (torch.Tensor): Targets tensor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get tp, fp, tn and fn counts for current update. If a count is discarded, then an empty tensor is returned.</span>
        <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_tp_fp_tn_fn</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="c1"># If this is first update since init or clear, initialize counts attributes and exit function</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts_initialized</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">true_negatives</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_negatives</span> <span class="o">=</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">counts_initialized</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span>

        <span class="c1"># If batch_dim has been specified, we accumulate counts for EACH INSTANCE seen throughout the updates, such</span>
        <span class="c1"># that each of the counts is a 2D tensor of row length equal to the samples seen.</span>
        <span class="c1"># NOTE: This ASSUMES the batch dimension comes FIRST for the counts.</span>
        <span class="c1"># Otherwise, the counts are 1D tensors with length equal to the number of classes (or possibly 1 if using the</span>
        <span class="c1"># BinaryClassificationMetric)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">,</span> <span class="n">tp</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span> <span class="o">+</span> <span class="n">tp</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">,</span> <span class="n">fp</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span> <span class="o">+</span> <span class="n">fp</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_negatives</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">true_negatives</span><span class="p">,</span> <span class="n">tn</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">true_negatives</span> <span class="o">+</span> <span class="n">tn</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_negatives</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">false_negatives</span><span class="p">,</span> <span class="n">fn</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">false_negatives</span> <span class="o">+</span> <span class="n">fn</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ClassificationMetric.clear">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.ClassificationMetric.clear">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset accumulated tp, fp, fn and tn&#39;s. They will be initialized with correct shape on next update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">false_negatives</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">true_negatives</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts_initialized</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="ClassificationMetric.compute">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.ClassificationMetric.compute">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metrics</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the metrics from the currently saved counts using the compute_from_counts function defined in</span>
<span class="sd">        inheriting classes</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str | None): Optional name used in conjunction with class attribute name to define key in metrics</span>
<span class="sd">                dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Metrics: A dictionary of string and ``Scalar`` representing the computed metric and its associated key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_from_counts</span><span class="p">(</span>
            <span class="n">true_positives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">true_positives</span><span class="p">,</span>
            <span class="n">false_positives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">false_positives</span><span class="p">,</span>
            <span class="n">true_negatives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">true_negatives</span><span class="p">,</span>
            <span class="n">false_negatives</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">false_negatives</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="k">return</span> <span class="n">metrics</span></div>


<div class="viewcode-block" id="ClassificationMetric.count_tp_fp_tn_fn">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.ClassificationMetric.count_tp_fp_tn_fn">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">count_tp_fp_tn_fn</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given two tensors containing model predictions and targets, returns the number of true positives (tp), false</span>
<span class="sd">        positives (fp), true negatives (tn), and false negatives (fn).</span>

<span class="sd">        The shape of these counts depends on the values of ``self.batch_dim`` and ``self.label_dim`` are specified</span>
<span class="sd">        and the implementation of the inheriting class.</span>

<span class="sd">        NOTE: Inheriting classes must implement additional functionality on top of this class. For example, any</span>
<span class="sd">        preprocessing that needs to be done to preds and targets should be done in the inheriting function. Any post</span>
<span class="sd">        processing should also be done there. See implementations in the `BinaryClassificationMetric` or</span>
<span class="sd">        `MultiClassificationMetric` class for examples.</span>

<span class="sd">        If any of the true positives, false positives, true negative, or false negative counts were specified to be</span>
<span class="sd">        discarded during initialization of the class, then that count will not be computed and an empty tensor will be</span>
<span class="sd">        returned in its place.</span>

<span class="sd">        Args:</span>
<span class="sd">            preds (torch.Tensor): Tensor containing model predictions. Must be the same shape as targets</span>
<span class="sd">            targets (torch.Tensor): Tensor containing prediction targets. Must be same shape as preds.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]: Tensors containing the counts along the</span>
<span class="sd">                specified dimensions for each of true positives, false positives, true negatives, and false negatives</span>
<span class="sd">                respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compute counts. If we&#39;re ignoring a count, set it as an empty tensor to avoid downstream errors.</span>
        <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_counts_from_preds_and_targets</span><span class="p">(</span>
            <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span>
        <span class="p">)</span>

        <span class="n">axes_to_ignore</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axes_to_ignore</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span><span class="p">)</span>
        <span class="n">sum_axes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">preds</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">axes_to_ignore</span><span class="p">])</span>

        <span class="c1"># If sum_axes is empty, then we have nothing to do.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sum_axes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_along_axes_or_discard</span><span class="p">(</span>
                <span class="n">sum_axes</span><span class="p">,</span> <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span></div>


<div class="viewcode-block" id="ClassificationMetric.compute_from_counts">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.ClassificationMetric.compute_from_counts">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_from_counts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">true_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">true_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metrics</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provided tensors associated with the various outcomes from predictions compared to targets in the form of</span>
<span class="sd">        true positives, false positives, true negatives, and false negatives, returns a dictionary of Scalar metrics.</span>
<span class="sd">        For example, one might compute recall as true_positives/(true_positives + false_negatives). The shape of these</span>
<span class="sd">        tensors is likely specific to the kind of classification being done (multi-class vs. binary) and the way</span>
<span class="sd">        predictions and targets have been provided etc.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_positives (torch.Tensor): Counts associated with positive predictions of a class and true positives</span>
<span class="sd">                for that class</span>
<span class="sd">            false_positives (torch.Tensor): Counts associated with positive predictions of a class and true negatives</span>
<span class="sd">                for that class</span>
<span class="sd">            true_negatives (torch.Tensor): Counts associated with negative predictions of a class and true negatives</span>
<span class="sd">                for that class</span>
<span class="sd">            false_negatives (torch.Tensor): Counts associated with negative predictions of a class and true positives</span>
<span class="sd">                for that class</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Must be implemented by the inheriting class</span>

<span class="sd">        Returns:</span>
<span class="sd">            Metrics: Metrics computed from the provided outcome counts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
</div>



<div class="viewcode-block" id="BinaryClassificationMetric">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.BinaryClassificationMetric">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BinaryClassificationMetric</span><span class="p">(</span><span class="n">ClassificationMetric</span><span class="p">):</span>
<div class="viewcode-block" id="BinaryClassificationMetric.__init__">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.BinaryClassificationMetric.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">label_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">batch_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="n">pos_label</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">discard</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">MetricOutcome</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A Base class for BINARY classification metrics that can be computed using the true positives (tp),</span>
<span class="sd">        false positive (fp), false negative (fn) and true negative (tn) counts. These counts are computed for</span>
<span class="sd">        each class independently. How they are composed together for the metric is left to inheriting classes.</span>

<span class="sd">        On each update, the true_positives, false_positives, false_negatives and true_negatives counts for the</span>
<span class="sd">        provided predictions and targets are accumulated into ``self.true_positives``, ``self.false_positives``,</span>
<span class="sd">        ``self.false_negatives`` and ``self.true_negatives``, respectively, for each label type. This reduces the</span>
<span class="sd">        memory footprint required to compute metrics across  rounds. The user needs to define the</span>
<span class="sd">        ``compute_from_counts`` method which returns a dictionary of Scalar metrics given the true_positives,</span>
<span class="sd">        false_positives, false_negatives, and true_negatives counts. The accumulated counts are reset by the ``clear``</span>
<span class="sd">        method. If your subclass returns multiple metrics you may need to also override the `__call__` method.</span>

<span class="sd">        If the predictions provided are continuous in value, then the associated counts will also be continuous</span>
<span class="sd">        (&quot;soft&quot;). For example, with a target of 1, a prediction of 0.8 contributes 0.8 to the true_positives count and</span>
<span class="sd">        0.2 to the false_negatives.</span>

<span class="sd">        NOTE: For this class, the predictions and targets passed to the update function MUST have the same shape</span>

<span class="sd">        NOTE: Preds and targets are expected to have elements in the interval [0, 1] or to be thresholded, using</span>
<span class="sd">        that argument to be as such.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the metric.</span>
<span class="sd">            label_dim (int | None, optional): Specifies which dimension in the provided tensors corresponds to the</span>
<span class="sd">                label dimension. During metric computation, this dimension must have size of AT MOST 2. If left as</span>
<span class="sd">                None, this class will assume that each entry in the tensor corresponds to a prediction/target, with</span>
<span class="sd">                the positive class indicated by predictions of 1. Defaults to None.</span>
<span class="sd">            batch_dim (int | None, optional): If None, then counts are aggregated across the batch dimension. If</span>
<span class="sd">                specified, counts will be computed along the dimension specified. That is, counts are maintained for</span>
<span class="sd">                each training sample INDIVIDUALLY. For example, if batch_dim = 1 and label_dim = 0, then</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    p = torch.tensor([[[0, 0, 0, 1], [1, 1, 1, 1]]])</span>

<span class="sd">                    t = torch.tensor([[[0, 0, 1, 0], [1, 1, 1, 1]]])</span>

<span class="sd">                    self.tp = torch.Tensor([[0], [4]])</span>

<span class="sd">                    self.tn = torch.Tensor([[2], [0]])</span>

<span class="sd">                    self.fp = torch.Tensor([[1], [0]])</span>

<span class="sd">                    self.fn = torch.Tensor([[1], [0]])</span>

<span class="sd">                NOTE: The resulting counts will always be presented batch dimension first, then label dimension,</span>
<span class="sd">                regardless of input shape. Defaults to None.</span>
<span class="sd">            dtype (torch.dtype): The dtype to store the counts as. If preds or targets can be continuous, specify a</span>
<span class="sd">                float type. Otherwise specify an integer type to prevent overflow. Defaults to float32</span>
<span class="sd">            pos_label (int, optional): The label relative to which to report the counts. Must be either 0 or 1.</span>
<span class="sd">                Defaults to 1.</span>
<span class="sd">            threshold (float | int | None, optional): A float for thresholding values or an integer specifying the</span>
<span class="sd">                index of the label dimension. If a float is given, predictions below the threshold are mapped</span>
<span class="sd">                to 0 and above are mapped to 1. If an integer is given, predictions are binarized based on the class</span>
<span class="sd">                with the highest prediction where the specified axis is assumed to contain a prediction for each class</span>
<span class="sd">                (where its index along that dimension is the class label). Value of None leaves preds unchanged.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            discard (set[MetricOutcome] | None, optional): One or several of MetricOutcome values. Specified outcome</span>
<span class="sd">                counts will not be accumulated. Their associated attribute will remain as an empty pytorch tensor.</span>
<span class="sd">                Useful for reducing the memory footprint of metrics that do not use all of the counts in their</span>
<span class="sd">                computation. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">label_dim</span><span class="o">=</span><span class="n">label_dim</span><span class="p">,</span>
            <span class="n">batch_dim</span><span class="o">=</span><span class="n">batch_dim</span><span class="p">,</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
            <span class="n">discard</span><span class="o">=</span><span class="n">discard</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">pos_label</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pos_label</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;pos_label must be either 0 or 1&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_label</span> <span class="o">=</span> <span class="n">pos_label</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_postprocess_count_tensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count_tensor</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a count tensor, in the various forms that it might appear, we need to post process these so that they</span>
<span class="sd">        can be returned to the user in the appropriate format. The structure of `count_tensor` after processing</span>
<span class="sd">        a batch of data will differ depending on whether the ``label_dim`` and ``batch_dim`` have been specified.</span>

<span class="sd">        That is, the shape of `count_tensor` will be:</span>

<span class="sd">        - If both ``label_dim`` and ``batch_dim`` have been provided, the count tensor will be 2D with the batch</span>
<span class="sd">          dimension first, followed by the label dimension.</span>
<span class="sd">        - If ``batch_dim`` has been provided, but not ``label_dim``, the count tensor will be 1D with a single count</span>
<span class="sd">          associated with each sample in the batch.</span>
<span class="sd">        - If ``label_dim`` has been provided, but not ``batch_dim``, the count tensor will have 1 or 2 elements,</span>
<span class="sd">          because it&#39;s a binary problem.</span>
<span class="sd">        - If neither has been provided then the tensor will have 1 element corresponding to the count over all</span>
<span class="sd">          tensor elements.</span>

<span class="sd">        NOTE: If the count has been specified as discarded, it will always simply be an empty tensor</span>

<span class="sd">        After postprocessing, the count tensor will always be RELATIVE to the class associated with the class at index</span>
<span class="sd">        1 or the implicit class associated with targets 1.0 (when preds/targets are not vector encoded). Returning</span>
<span class="sd">        values relative to the opposite class is handled elsewhere.</span>

<span class="sd">        Args:</span>
<span class="sd">            count_tensor (torch.Tensor): Count tensor with the correct shape and meaning.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Raises errors if the tensor does not have the right shape for the expected setting</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: Count tensor of the appropriate shape and structure. If `self.batch_dim` is not None</span>
<span class="sd">                then the postprocessed `count_tensor` will have shape (batch size, 1), Otherwise, it will have shape</span>
<span class="sd">                (1,). In both settings, the count is relative to the label at index 1 (implied or explicit).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If tensor is empty, we do nothing</span>
        <span class="k">if</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">count_tensor</span>

        <span class="n">count_ndims</span> <span class="o">=</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">ndim</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Both a batch and label dim have been specified. So tensor should be 2D and either have 1 or 2 columns</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">count_ndims</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Batch and label dims have been specified, tensor should be 2D, but got </span><span class="si">{</span><span class="n">count_ndims</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">:</span>
                <span class="c1"># reshape so that batch dimension comes first</span>
                <span class="n">count_tensor</span> <span class="o">=</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Always return the class with label 1 (pos_label 0 will be handled by rearranging counts if necessary)</span>
                <span class="k">return</span> <span class="n">count_tensor</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">count_tensor</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Label dimension has unexpected size of </span><span class="si">{</span><span class="n">count_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Batch dim has been specified but label dim has not, Tensor should be 1D equivalent to size of the batch</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">count_ndims</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Batch dim has been specified but not label dim, tensor should be 1D but got </span><span class="si">{</span><span class="n">count_ndims</span><span class="si">}</span><span class="s2">D&quot;</span>
            <span class="k">return</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Tensor should be 1D equivalent to size of labels dimension if it has been specified or a single element</span>
            <span class="c1"># if label dims has not be specified. The label dimension is of size at most 2, but can be of size 1 if</span>
            <span class="c1"># there is a dimension for an &quot;implied&quot; label (i.e. 0.8 representing vector predictions [0.2, 0.8]). If</span>
            <span class="c1"># there is no label dimension specified, there should only be a single element as well.</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="n">count_ndims</span> <span class="o">&lt;=</span> <span class="mi">1</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Batch dim has not been specified, tensor should be 0 or 1D but got </span><span class="si">{</span><span class="n">count_ndims</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;self.label_dim is None but got two elements in the count_tensor&quot;</span>
                <span class="c1"># Always return the class with label 1</span>
                <span class="k">return</span> <span class="n">count_tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">count_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Too many elements in the count tensor, expected 2 or less and got </span><span class="si">{</span><span class="n">count_tensor</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

<div class="viewcode-block" id="BinaryClassificationMetric.count_tp_fp_tn_fn">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.BinaryClassificationMetric.count_tp_fp_tn_fn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">count_tp_fp_tn_fn</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Given two tensors containing model predictions and targets, returns the number of true positives (tp), false</span>
<span class="sd">         positives (fp), true negatives (tn), and false negatives (fn).</span>

<span class="sd">        The shape of these counts depends on the values of ``self.batch_dim`` and ``self.label_dim`` are specified.</span>
<span class="sd">        They also depend on the shape of the input and target for this class. As binary predictions may be explicit</span>
<span class="sd">        (vector encoded) or implicit (single value implying values for the negative and positive classes).</span>

<span class="sd">         If any of the true positives, false positives, true negative, or false negative counts were specified to be</span>
<span class="sd">         discarded during initialization of the class, then that count will not be computed and an empty tensor will be</span>
<span class="sd">         returned in its place.</span>

<span class="sd">         Args:</span>
<span class="sd">             preds (torch.Tensor): Tensor containing model predictions. Must be the same shape as targets</span>
<span class="sd">             targets (torch.Tensor): Tensor containing prediction targets. Must be same shape as preds.</span>

<span class="sd">         Returns:</span>
<span class="sd">             tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]: Tensors containing the counts along the</span>
<span class="sd">                 specified dimensions for each of true positives, false positives, true negatives, and false negatives,</span>
<span class="sd">                 respectively. If `self.batch_dim` is not None then these tensors will have shape (batch size, 1),</span>
<span class="sd">                 Otherwise, it will have shape (1,). The counts will be relative to the index of ``self.pos_label``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Transform preds and targets as necessary/specified before computing counts</span>
        <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_tensors</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># Make sure the tensors have the correct value ranges for sensible computation of the counts</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_assert_correct_ranges</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="c1"># Make sure after transformation the preds and targets have the right shape</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">preds</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">targets</span><span class="o">.</span><span class="n">shape</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Preds and targets must have the same shape but got </span><span class="si">{</span><span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> respectively.&quot;</span>

        <span class="c1"># Assert that the label dimension for these tensors is of size 2 at most.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Label dimension for preds tensor is greater than 2 </span><span class="si">{</span><span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">]</span><span class="si">}</span><span class="s2">. This class is &quot;</span>
                <span class="s2">&quot;meant for binary metric computation only&quot;</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Label dimension for targets tensor is greater than 2 </span><span class="si">{</span><span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">]</span><span class="si">}</span><span class="s2">. This class is &quot;</span>
                <span class="s2">&quot;meant for binary metric computation only&quot;</span>
            <span class="p">)</span>

        <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">count_tp_fp_tn_fn</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="n">true_positives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_count_tensor</span><span class="p">(</span><span class="n">true_positives</span><span class="p">)</span>
        <span class="n">false_positives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_count_tensor</span><span class="p">(</span><span class="n">false_positives</span><span class="p">)</span>
        <span class="n">true_negatives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_count_tensor</span><span class="p">(</span><span class="n">true_negatives</span><span class="p">)</span>
        <span class="n">false_negatives</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postprocess_count_tensor</span><span class="p">(</span><span class="n">false_negatives</span><span class="p">)</span>

        <span class="c1"># Need to flip the label interpretations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_label</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span><span class="p">,</span> <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span>

        <span class="k">return</span> <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span></div>


<div class="viewcode-block" id="BinaryClassificationMetric.compute_from_counts">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.BinaryClassificationMetric.compute_from_counts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_from_counts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">true_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">true_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metrics</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provided tensors associated with the various outcomes from predictions compared to targets in the form of</span>
<span class="sd">        true positives, false positives, true negatives, and false negatives, returns a dictionary of Scalar metrics.</span>
<span class="sd">        For example, one might compute recall as true_positives/(true_positives + false_negatives). The shape of these</span>
<span class="sd">        tensors are specific to how this object is configured, see class documentation above.</span>

<span class="sd">        For this class it is assumed that all counts are presented relative to the class indicated by the `pos_label`</span>
<span class="sd">        index. Moreover, they are assumed to either have a single entry or have shape (num_samples, 1). In the former,</span>
<span class="sd">        a single count is presented ACROSS all samples relative to the `pos_label` specified. In the latter, counts</span>
<span class="sd">        are computed WITHIN each sample, but held separate across samples. A concrete setting where this makes sense</span>
<span class="sd">        is binary image segmentation. You can have such counts summed for all pixels within an image, but separate</span>
<span class="sd">        per image. A metric could then be computed for each image and then averaged.</span>

<span class="sd">        Args:</span>
<span class="sd">            true_positives (torch.Tensor): Counts associated with positive predictions and positive labels</span>
<span class="sd">            false_positives (torch.Tensor): Counts associated with positive predictions and negative labels</span>
<span class="sd">            true_negatives (torch.Tensor): Counts associated with negative predictions and negative labels</span>
<span class="sd">            false_negatives (torch.Tensor): Counts associated with negative predictions and positive labels</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Must be implemented by the inheriting class</span>

<span class="sd">        Returns:</span>
<span class="sd">            Metrics: Metrics computed from the provided outcome counts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Scalar</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User defined convenience method that calculates the desired metric given the predictions and target without</span>
<span class="sd">        accumulating it into the class itself</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: User must define this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>



<div class="viewcode-block" id="MultiClassificationMetric">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.MultiClassificationMetric">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiClassificationMetric</span><span class="p">(</span><span class="n">ClassificationMetric</span><span class="p">):</span>
<div class="viewcode-block" id="MultiClassificationMetric.__init__">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.MultiClassificationMetric.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">label_dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">batch_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ignore_background</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">discard</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="n">MetricOutcome</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A Base class for multi-class, multi-label classification metrics that can be computed using the true</span>
<span class="sd">        positives (tp), false positive (fp), false negative (fn) and true negative (tn) counts. These counts are</span>
<span class="sd">        computed for each class independently. How they are composed together for the metric is left to inheriting</span>
<span class="sd">        classes.</span>

<span class="sd">        On each update, the true_positives, false_positives, false_negatives and true_negatives counts for the</span>
<span class="sd">        provided predictions and targets are accumulated into ``self.true_positives``, ``self.false_positives``,</span>
<span class="sd">        ``self.false_negatives`` and ``self.true_negatives``, respectively, for each label type. This reduces the</span>
<span class="sd">        memory footprint required to compute metrics across rounds. The user needs to define the</span>
<span class="sd">        ``compute_from_counts`` method which returns a dictionary of Scalar metrics given the true_positives,</span>
<span class="sd">        false_positives, false_negatives, and true_negatives counts. The accumulated counts are reset by the</span>
<span class="sd">        ``clear`` method. If your subclass returns multiple metrics you may need to also override the `__call__`</span>
<span class="sd">        method.</span>

<span class="sd">        If the predictions provided are continuous in value, then the associated counts will also be continuous</span>
<span class="sd">        (&quot;soft&quot;). For example, with a target of 1, a prediction of 0.8 contributes 0.8 to the true_positives count and</span>
<span class="sd">        0.2 to the false_negatives.</span>

<span class="sd">        NOTE: Preds and targets are expected to have elements in the interval [0, 1] or to be thresholded, using</span>
<span class="sd">        that argument to be as such.</span>

<span class="sd">        NOTE: If preds and targets passed to update method have different shapes, or end up with different shapes</span>
<span class="sd">        after thresholding, this class will attempt to align the shapes by one-hot-encoding one of the tensors in the</span>
<span class="sd">        label dimension, if possible.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): The name of the metric.</span>
<span class="sd">            label_dim (int): Specifies which dimension in the provided tensors corresponds to the label</span>
<span class="sd">                dimension. During metric computation, this dimension must have size of AT LEAST 2.</span>
<span class="sd">            batch_dim (int | None, optional): If None, then counts are aggregated across the batch dimension. If</span>
<span class="sd">                specified, counts will be computed along the dimension specified. That is, counts are maintained for</span>
<span class="sd">                each training sample INDIVIDUALLY. For example, if batch_dim = 1 and label_dim = 0, then</span>

<span class="sd">                .. code-block:: python</span>

<span class="sd">                    p = torch.tensor([[[1., 1., 1., 0.], [0., 0., 0., 0.]], [[0., 0., 0., 1.], [1., 1., 1., 1.]]])</span>

<span class="sd">                    t = torch.tensor([[[1., 1., 0., 0.], [0., 0., 0., 0.]], [[0., 0., 1., 1.], [1., 1., 1., 1.]]])</span>

<span class="sd">                    self.tp = torch.Tensor([[2, 1], [0, 4]])</span>

<span class="sd">                    self.tn = torch.Tensor([[1, 2], [4, 0]])</span>

<span class="sd">                    self.fp = torch.Tensor([[1, 0], [0, 0]])</span>

<span class="sd">                    self.fn = torch.Tensor([[0, 1], [0, 0]])</span>

<span class="sd">                NOTE: The resulting counts will always be presented batch dimension first, then label dimension,</span>
<span class="sd">                regardless of input shape. Defaults to None</span>
<span class="sd">            dtype (torch.dtype): The dtype to store the counts as. If preds or targets can be continuous, specify a</span>
<span class="sd">                float type. Otherwise specify an integer type to prevent overflow. Defaults to torch.float32</span>
<span class="sd">            threshold (float | int | None, optional): A float for thresholding values or an integer specifying the</span>
<span class="sd">                index of the label dimension. If a float is given, predictions below the threshold are mapped</span>
<span class="sd">                to 0 and above are mapped to 1. If an integer is given, predictions are binarized based on the class</span>
<span class="sd">                with the highest prediction where the specified axis is assumed to contain a prediction for each class</span>
<span class="sd">                (where its index along that dimension is the class label). Value of None leaves preds unchanged.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            ignore_background (int | None): If specified, the FIRST channel of the specified axis is removed prior to</span>
<span class="sd">                computing the counts. Useful for removing background classes. Defaults to None.</span>
<span class="sd">            discard (set[MetricOutcome] | None, optional): One or several of MetricOutcome values. Specified outcome</span>
<span class="sd">                counts will not be accumulated. Their associated attribute will remain as an empty pytorch tensor.</span>
<span class="sd">                Useful for reducing the memory footprint of metrics that do not use all of the counts in their</span>
<span class="sd">                computation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
            <span class="n">label_dim</span><span class="o">=</span><span class="n">label_dim</span><span class="p">,</span>
            <span class="n">batch_dim</span><span class="o">=</span><span class="n">batch_dim</span><span class="p">,</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
            <span class="n">discard</span><span class="o">=</span><span class="n">discard</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ignore_background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span>
                <span class="n">INFO</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;ignore_background has been specified. The first channel of dimension </span><span class="si">{</span><span class="n">ignore_background</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;will be removed from both predictions and targets&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_background</span> <span class="o">=</span> <span class="n">ignore_background</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_remove_background</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">ignore_background</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes the first element (channel) from the dimension specified in ignore_background for both the preds</span>
<span class="sd">        and targets tensors. For example, if preds and targets have shape (64, 10, 10, 3) and ignore_background is 3,</span>
<span class="sd">        then after removing the specified background, the shapes will be (64, 10, 10, 2)</span>

<span class="sd">        The tensors should have the same shape before and after removing the background.</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_background (int): Which dimension should have the first element (channel) removed</span>
<span class="sd">            preds (torch.Tensor): predictions tensor</span>
<span class="sd">            targets (torch.Tensor): targets tensor</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[torch.Tensor, torch.Tensor]: predictions and targets tensor with the appropriate background removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">preds</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">targets</span><span class="o">.</span><span class="n">shape</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Preds (</span><span class="si">{</span><span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">) and targets (</span><span class="si">{</span><span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">) should have the same shape but do not.&quot;</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">ignore_background</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">preds</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">ignore_background</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">index_select</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">ignore_background</span><span class="p">,</span> <span class="n">indices</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_transpose_2d_matrix_unless_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper function to transpose the provided matrix if it is 2D. This is mainly used to put the batch dimension</span>
<span class="sd">        before the label dimension if required. The tensor might be empty if it corresponds to a discarded outcome</span>
<span class="sd">        type. If so, it is returned unchanged. Otherwise, we throw an error, as the shape is unexpected.</span>

<span class="sd">        Args:</span>
<span class="sd">            matrix (torch.Tensor): tensor to be transposed</span>

<span class="sd">        Returns:</span>
<span class="sd">            torch.Tensor: transposed tensor if 2D, unchanged tensor if empty, and throw error if shape differs from</span>
<span class="sd">                those two expected settings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matrix</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">matrix</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matrix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected tensor to either be 2D or empty but has shape </span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_transform_tensors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the predictions and targets this function performs a few possible transformations. The first is to map</span>
<span class="sd">        boolean tensors to integers for computation. The second is to potentially threshold the predictions if</span>
<span class="sd">        self.threshold is not None. Both are facilitated by the base class.</span>

<span class="sd">        Thereafter, we attempt to align the tensors if they aren&#39;t already of the same shape. This is done by</span>
<span class="sd">        attempting to expand the label encodings for class indices to one-hot vectors. See documentation of</span>
<span class="sd">        ``align_pred_and_target_shapes`` for more details.</span>

<span class="sd">        As a last possible transformation, the background is removed if self.ignore_background is defined.</span>

<span class="sd">        Args:</span>
<span class="sd">            preds (torch.Tensor): Predictions tensor</span>
<span class="sd">            targets (torch.Tensor): Targets tensor</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[torch.Tensor, torch.Tensor]: Potentially transformed predictions and targets tensors, in that order</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_transform_tensors</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="c1"># Attempt to automatically match pred and target shape.</span>
        <span class="c1"># This supports any combination of hard/soft, vector/not-vector encoded</span>
        <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">align_pred_and_target_shapes</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">)</span>

        <span class="c1"># Remove the background channel from the axis specified by ignore_background_axis</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_background</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_background</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_background</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span>

<div class="viewcode-block" id="MultiClassificationMetric.count_tp_fp_tn_fn">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.MultiClassificationMetric.count_tp_fp_tn_fn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">count_tp_fp_tn_fn</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">preds</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">targets</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given two tensors containing model predictions and targets, returns the number of true positives (tp), false</span>
<span class="sd">        positives (fp), true negatives (tn), and false negatives (fn).</span>

<span class="sd">        If any of the true positives, false positives, true negative, or false negative counts were specified to be</span>
<span class="sd">        discarded during initialization of the class, then that count will not be computed and an empty tensor will be</span>
<span class="sd">        returned in its place.</span>

<span class="sd">        For this class, counts will either have shape (num_labels,) or (num_samples, num_labels), depending on if the</span>
<span class="sd">        `batch_dim` (former case) is specified or not (latter case).</span>

<span class="sd">        Args:</span>
<span class="sd">            preds (torch.Tensor): Tensor containing model predictions.</span>
<span class="sd">            targets (torch.Tensor): Tensor containing prediction targets.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple[torch.Tensor, torch.Tensor, torch.Tensor, torch.Tensor]: Tensors containing the counts along the</span>
<span class="sd">                specified dimensions for each of true positives, false positives, true negatives, and false negatives</span>
<span class="sd">                respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Transform preds and targets as necessary/specified before computing counts</span>
        <span class="n">preds</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_tensors</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="c1"># Make sure the tensors have the correct value ranges for sensible computation of the counts</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_assert_correct_ranges</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="c1"># Assert that the label dimension for these tensors is not of size 1. This occurs either when considering</span>
        <span class="c1"># binary predictions or when both the preds and targets are label index encoded, which is not admissible for</span>
        <span class="c1"># this function</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">preds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Label dimension for preds tensor is less than 2. Either your label dimension is a single float value &quot;</span>
            <span class="s2">&quot;corresponding to a binary prediction or it is a class label that needs to be vector encoded.&quot;</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">targets</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Label dimension for targets tensor is less than 2. Either your label dimension is a single float value &quot;</span>
            <span class="s2">&quot;corresponding to a binary prediction or it is a class label that needs to be vector encoded.&quot;</span>
        <span class="p">)</span>

        <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">count_tp_fp_tn_fn</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

        <span class="c1"># If batch dim is larger than label_dim, then we re-order them so that batch_dim comes first after summation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_dim</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_dim</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transpose_2d_matrix_unless_empty</span><span class="p">(</span><span class="n">true_positives</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transpose_2d_matrix_unless_empty</span><span class="p">(</span><span class="n">false_positives</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transpose_2d_matrix_unless_empty</span><span class="p">(</span><span class="n">true_negatives</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_transpose_2d_matrix_unless_empty</span><span class="p">(</span><span class="n">false_negatives</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">true_positives</span><span class="p">,</span> <span class="n">false_positives</span><span class="p">,</span> <span class="n">true_negatives</span><span class="p">,</span> <span class="n">false_negatives</span></div>


<div class="viewcode-block" id="MultiClassificationMetric.compute_from_counts">
<a class="viewcode-back" href="../../../reference/api/fl4health.metrics.efficient_metrics_base.html#fl4health.metrics.efficient_metrics_base.MultiClassificationMetric.compute_from_counts">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">compute_from_counts</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">true_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_positives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">true_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
        <span class="n">false_negatives</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metrics</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provided tensors associated with the various outcomes from predictions compared to targets in the form of</span>
<span class="sd">        true positives, false positives, true negatives, and false negatives, returns a dictionary of Scalar metrics.</span>
<span class="sd">        For example, one might compute recall as true_positives/(true_positives + false_negatives). The shape of these</span>
<span class="sd">        tensors is The shape of these tensors are specific to how this object is configured, see class documentation</span>
<span class="sd">        above.</span>

<span class="sd">        For this class, counts are assumed to have shape (num_labels,) or (num_samples, num_labels). In the former,</span>
<span class="sd">        counts have been aggregated ACROSS samples into single count values for each possible label. In the later,</span>
<span class="sd">        counts have been aggregated WITHIN each sample and remain separate across examples. A concrete setting where</span>
<span class="sd">        this makes sense is image segmentation. You can have such counts summed for all pixels within an image, but</span>
<span class="sd">        separate per image. A metric could then be computed for each image and then averaged.</span>

<span class="sd">        NOTE: A user can implement further reduction along the label dimension (summing TPs across labels for example),</span>
<span class="sd">        if desired. It just needs to be handled in the implementation of this function</span>

<span class="sd">        Args:</span>
<span class="sd">            true_positives (torch.Tensor): Counts associated with positive predictions of a class and true positives</span>
<span class="sd">                for that class</span>
<span class="sd">            false_positives (torch.Tensor): Counts associated with positive predictions of a class and true negatives</span>
<span class="sd">                for that class</span>
<span class="sd">            true_negatives (torch.Tensor): Counts associated with negative predictions of a class and true negatives</span>
<span class="sd">                for that class</span>
<span class="sd">            false_negatives (torch.Tensor): Counts associated with negative predictions of a class and true positives</span>
<span class="sd">                for that class</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: Must be implemented by the inheriting class</span>

<span class="sd">        Returns:</span>
<span class="sd">            Metrics: Metrics computed from the provided outcome counts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Scalar</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User defined convenience method that calculates the desired metric given the predictions and target without</span>
<span class="sd">        accumulating it into the class itself</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: User must define this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Vector AI Engineering
            </div>
            <!--
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
            -->
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/VectorInstitute/FL4Health" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>  # noqa: E501
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        <div class="footer-container" style="text-align: center;">
          <div class="logo">
            <a class="logo" href="https://vectorinstitute.ai/">
              <span class="logo"></span>
              <img alt="Logo of the Vector Institute" style="width:90px; max-width:90px;" src="../../../_static/logos/vector_logo.png" />
            </a>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div></body>
</html>